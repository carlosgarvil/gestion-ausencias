<!-- TODO: esta página debe servir para mostrar las tareas de cada grupo según las ausencias del día actual. Mostrará una tabla con las tareas en primera columna. Las tareas se encuentran en la columnas tasks de la tabla absences. La segunda columna para el grupo (group_name) junto con el aula (classroom) y la tercera columna para la franja horaria donde ese grupo tiene la ausencia. Como idea, puedes coger panel.html porque será una modificación de ese archivo. -->

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Gestión de ausencias - Tareas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png" />
  <link rel="shortcut icon" href="img/favicon.ico" />
  <meta name="msapplication-TileColor" content="#2b5797" />
  <meta name="msapplication-TileImage" content="img/android-chrome-192x192.png" />
  <meta name="theme-color" content="#ffffff" />
</head>

<body>
  <div id="app">
    <h1>Gestión de ausencias del profesorado</h1>

    <section id="login-section" v-if="!isLoggedIn">
      <h2>Acceso</h2>
      <form @submit.prevent="handleLogin">
        <label>
          Correo
          <input type="email" v-model="loginForm.email" required />
        </label>
        <label>
          Contraseña
          <input type="password" v-model="loginForm.password" required />
        </label>
        <button type="submit">Entrar</button>
        <div v-if="loginMessage" class="message" :class="loginMessageType">{{ loginMessage }}</div>
      </form>
    </section>
    <section id="app-section" v-else>
      <header class="app-header">
        <div class="header-left">
          <span class="session-text">
            Sesión iniciada como <strong>{{ userEmail }}</strong>
          </span>
        </div>
        <button id="btn-logout" type="button" class="btn-logout" @click="handleLogout">Cerrar sesión</button>
      </header>

      <nav class="top-nav">
        <a class="nav-link" href="index.html">Ausencias</a>
        <a class="nav-link" href="panel.html">Panel</a>
        <a class="nav-link active" href="tareas.html">Tareas</a>
        <a class="nav-link" href="justificaciones.html">Gestión de Justificantes</a>
        <a class="nav-link" href="profesorado.html">Horario del Profesorado</a>
        <a class="nav-link" href="horario-grupos.html">Horario de Grupos</a>
        <a class="nav-link" href="gestion_profesorado.html">Añadir/quitar profesorado</a>
        <a class="nav-link" href="permisos.html">Permisos P27</a>
        <a class="nav-link" href="control-presencia.html">Control de presencia</a>
        <a class="nav-link" href="ayuda.html">Ayuda</a>
      </nav>

      <section id="tasks-section">
        <div class="panel-header">
          <h2>Tareas del día</h2> 
            <button id="btn-print" onclick="window.print()">
              Imprimir / PDF
            </button>
            <a class="panel-link" href="https://drive.google.com/drive/folders/1RRHA17OY5JTmvCRK5buK5kBzJmgpYxrz2_HFMOudcJAv3hoySdyy-iHu9voHTnLFT6aN0Fg3?usp=drive_link" target="_blank" rel="noopener">
              <button>
                <img src="img/gdrive_icon.png" alt="" class="panel-link-icon">
                Archivos adjuntos
              </button>
              <img src="img/carpeta_adjuntos.png" alt="QR Carpeta Drive" class="panel-link-qr">
            </a>
          
          <div class="panel-controls">
            <label>
              Fecha
              <input type="date" v-model="tasksDate" />
            </label>
            <button type="button" class="btn-refresh" @click="loadTasksForDate">Actualizar</button>
          </div>
        </div>

        <div class="panel-table-wrapper">
          <p v-if="loadingTasks">Cargando tareas…</p>
          <p v-else-if="tasksMessage">{{ tasksMessage }}</p>
          <table v-else class="panel-table">
            <thead>
              <tr>
                <th>Profesor</th>
                <th>Franja horaria (grupo y aula)</th>
                <th>Tareas</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(row, index) in tasksRows" :key="row.key || `${row.teacher}-${index}`">
                <td>
                  {{ row.teacher }}
                </td>
                <td>
                  <span v-for="(slotLine, slotIndex) in row.slotLines" :key="`${row.key}-slot-${slotIndex}`">
                    {{ slotLine }}<br v-if="slotIndex < row.slotLines.length - 1">
                  </span>
                </td>
                <td>{{ row.task }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </section>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
</body>

</html>
