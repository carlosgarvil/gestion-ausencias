<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Gestión de ausencias - IES Polígono Sur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png" />
  <link rel="shortcut icon" href="img/favicon.ico" />
  <meta name="msapplication-TileColor" content="#2b5797" />
  <meta name="msapplication-TileImage" content="img/android-chrome-192x192.png" />
  <meta name="theme-color" content="#ffffff" />
</head>

<body>
  <div id="app">
    <h1>Gestión de ausencias del profesorado</h1>

    <section id="login-section" v-if="!isLoggedIn">
      <h2>Acceso</h2>
      <form @submit.prevent="handleLogin">
        <label>
          Correo
          <input type="email" v-model="loginForm.email" required />
        </label>
        <label>
          Contraseña
          <input type="password" v-model="loginForm.password" required />
        </label>
        <button type="submit">Entrar</button>
        <div v-if="loginMessage" class="message" :class="loginMessageType">{{ loginMessage }}</div>
      </form>
    </section>

    <section id="app-section" v-else>
      <header class="app-header">
        <div class="header-left">
          <span class="session-text">
            Sesión iniciada como <strong>{{ userEmail }}</strong>
          </span>
        </div>
        <button id="btn-logout" type="button" class="btn-logout" @click="handleLogout">Cerrar sesión</button>
      </header>

      <nav class="top-nav">
        <a class="nav-link" href="index.html">Ausencias</a>
        <a class="nav-link" href="panel.html">Panel</a>
        <a class="nav-link active" href="justificaciones.html">Justificantes</a>
        <a class="nav-link" href="profesorado.html">Profesorado</a>
        <a class="nav-link" href="gestion_profesorado.html">Gestión del profesorado</a>
        <a class="nav-link" href="permisos.html">Permisos</a>
        <a class="nav-link" href="control-presencia.html">Control de presencia</a>
        <a class="nav-link" href="ayuda.html">Ayuda</a>
      </nav>

      <section id="justifications-section">
        <div class="justifications-header">
          <h2> Justificantes</h2>
          <label class="filter-checkbox">
            <input type="checkbox" v-model="hideJustified" />
            Ocultar justificados
          </label>
          <label class="month-picker">
            Mes
            <input type="month" v-model="justificationsMonth" />
          </label>
        </div>

        <div class="justifications-content">
          <p v-if="loadingJustifications">Cargando ausencias…</p>
          <p v-else-if="justificationsMessage">{{ justificationsMessage }}</p>
          <p v-else-if="!filteredJustifications.length">No hay ausencias registradas para este mes.</p>

          <table v-else class="justifications-table">
            <thead>
              <tr>
                <th>Docente</th>
                <th>Fecha</th>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Motivo</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="justification in filteredJustifications" :key="justification.id">
                <td>{{ justification.teacher_name }}</td>
                <td>{{ formatDateForDisplay(justification.date) }}</td>
                <td>{{ getSlotLabel(justification.start_slot) }}</td>
                <td>{{ getSlotLabel(justification.end_slot) }}</td>
                <td>{{ truncateReason(justification.reason) }}</td>
                <td>
                  <select class="status-select" :value="justification.status"
                    @change="updateJustificationStatus(justification, $event.target.value)">
                    <option v-for="option in justificationStatusOptions" :key="option.value" :value="option.value">
                      {{ option.label }}
                    </option>
                  </select>
                  <span v-if="justification.statusMessage" class="status-message"
                    :class="justification.statusMessageType">
                    {{ justification.statusMessage }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </section>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
</body>

</html>