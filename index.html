<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de ausencias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <h1>Registro de ausencias</h1>

  <!-- Bloque de LOGIN -->
  <section id="login-section">
    <h2>Acceso</h2>
    <form id="login-form">
      <label>
        Correo
        <input type="email" id="login-email" required />
      </label>
      <label>
        ContraseÃ±a
        <input type="password" id="login-password" required />
      </label>
      <button type="submit">Entrar</button>
      <div id="login-message" class="message hidden"></div>
    </form>
  </section>

  <!-- Bloque de APP (solo visible si hay sesiÃ³n) -->
<!-- Bloque de APP (solo visible si hay sesiÃ³n) -->
<section id="app-section" class="hidden">

  <header class="app-header">
    <div class="header-left">
      <!--<img src="logo-ies.png" alt="Logo IES" class="ies-logo">-->
      <span class="session-text">
        SesiÃ³n iniciada como <strong id="user-email"></strong>
      </span>
    </div>

    <button id="btn-logout" type="button" class="btn-logout">Cerrar sesiÃ³n</button>
  </header>
  <hr/>
  <div class="app-grid">
    <!-- Columna izquierda: formulario de NUEVA ausencia -->
    <section id="form-section">
      <h2>Registrar nueva ausencia</h2>
<ul>
        <li>ğŸ“… <strong>Una fecha</strong> â†’ crea una ausencia individual.</li>
        <li>ğŸ—“ï¸ <strong>Con "Fecha hasta"</strong> â†’ se genera una ausencia por cada dÃ­a en el rango indicado.</li>
      </ul>
      <form id="absence-form">
        <label>
          Docente
          <select id="teacher-select" required>
            <option value="">Seleccionaâ€¦</option>
          </select>
        </label>

        <label>
          Fecha desde
          <input type="date" id="date-from" required />
        </label>

        <label>
          Fecha hasta (opcional)
          <input type="date" id="date-to" />
        </label>

        <label>
          Hora inicial (tramo)
          <select id="start-slot" required>
            <option value="1" selected>08:15â€“09:15</option>
            <option value="2">09:15â€“10:15</option>
            <option value="3">10:15â€“11:15</option>
            <option value="4">11:15â€“11:45 (recreo)</option>
            <option value="5">11:45â€“12:45</option>
            <option value="6">12:45â€“13:45</option>
            <option value="7">13:45â€“14:45</option>
            <option value="8">15:00â€“16:00</option>
            <option value="9">16:00â€“17:00</option>
            <option value="10">17:00â€“18:00</option>
            <option value="11">18:00â€“18:15 (recreo)</option>
            <option value="12">18:15â€“19:15</option>
            <option value="13">19:15â€“20:15</option>
            <option value="14">20:15â€“21:15</option>
          </select>
        </label>

        <label>
          Hora final (tramo)
          <select id="end-slot" required>
            <option value="1">08:15â€“09:15</option>
            <option value="2">09:15â€“10:15</option>
            <option value="3">10:15â€“11:15</option>
            <option value="4">11:15â€“11:45 (recreo)</option>
            <option value="5">11:45â€“12:45</option>
            <option value="6">12:45â€“13:45</option>
            <option value="7">13:45â€“14:45</option>
            <option value="8">15:00â€“16:00</option>
            <option value="9">16:00â€“17:00</option>
            <option value="10">17:00â€“18:00</option>
            <option value="11">18:00â€“18:15 (recreo)</option>
            <option value="12">18:15â€“19:15</option>
            <option value="13">19:15â€“20:15</option>
            <option value="14" selected>20:15â€“21:15</option>
          </select>
        </label>

        <label>
          Motivo (opcional)
          <textarea id="reason" rows="2"></textarea>
        </label>

<button type="submit" class="btn-save">Guardar ausencia</button>
        <div id="absence-message" class="message hidden"></div>
      </form>
    </section>

    <!-- Columna derecha: selector de fecha + lista de ausencias -->
    <section id="list-section">
      <h2>Ausencias del dÃ­a</h2>
      <label>
        Fecha
        <input type="date" id="list-date" />
      </label>
<button type="button" id="btn-refresh-list" class="btn-refresh">Actualizar</button>

      <div id="list-container" style="margin-top: 0.75rem;"></div>
    </section>
  </div>
  <hr/>
    <section id="substitutions-section">
    <h2>ğŸ” GestiÃ³n de sustituciones</h2>
      <p>
  En caso de sustituciÃ³n, es necesario que las ausencias enviadas desde el formulario del centro se registren correctamente y que aparezca el nombre correcto en el panel general. Si el docente sustituto es asimismo sustituido, deberÃ¡ indicarse el cambio siempre con respecto al <strong>docente titular</strong>.
</p><p>Puede revertir la sustituciÃ³n con el botÃ³n â€œQuitar sustitutoâ€.</p>

    <div class="substitutions-layout">
      <!-- Bloque izquierda: sustituciones activas -->
      <div class="substitutions-block">
        <h3>Sustituciones activas</h3>
        <p class="absence-meta">Si el correo del formulario es distinto al del titular, se considera que hay una sustituciÃ³n activa.</p>
        <table class="substitutions-table">
          <thead>
            <tr>
              <th>Titular</th>
              <th>Nombre en panel</th>
              <th>Email formulario</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="substitutions-body">
            <!-- AquÃ­ se inyectarÃ¡n las filas por JS -->
          </tbody>
        </table>
        <p id="substitutions-empty" class="absence-meta" style="margin-top:0.4rem; display:none;">
          No hay sustituciones activas.
        </p>
      </div>

      <!-- Bloque derecha: aÃ±adir sustituto -->
      <div class="substitutions-block">
        <h3>AÃ±adir / cambiar sustituto</h3>
        <form id="substitution-form">
          <label>
            Profesor titular
            <select id="substitution-teacher-select" required>
              <option value="">Selecciona titularâ€¦</option>
            </select>
          </label>

          <label>
            Nombre que se mostrarÃ¡ en el panel (Apellidos, Nombre)
            <input type="text" id="substitution-display-name" required />
          </label>

          <label>
            Email del sustituto
            <input type="email" id="substitution-email-form" required value="@iespoligonosur.org"/>
          </label>

          <button type="submit" class="btn-save">Guardar sustituciÃ³n</button>
        </form>
      </div>
    </div>
  </section>

</section>

  <!-- Supabase JS desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
   <script src="script.js"></script>
    
</body>
</html>

