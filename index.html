<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de ausencias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <h1>Registro de ausencias</h1>

  <!-- Bloque de LOGIN -->
  <section id="login-section">
    <h2>Acceso</h2>
    <form id="login-form">
      <label>
        Correo
        <input type="email" id="login-email" required />
      </label>
      <label>
        Contrase√±a
        <input type="password" id="login-password" required />
      </label>
      <button type="submit">Entrar</button>
      <div id="login-message" class="message hidden"></div>
    </form>
  </section>

  <!-- Bloque de APP (solo visible si hay sesi√≥n) -->
<!-- Bloque de APP (solo visible si hay sesi√≥n) -->
<section id="app-section" class="hidden">

  <header class="app-header">
    <div class="header-left">
      <!--<img src="logo-ies.png" alt="Logo IES" class="ies-logo">-->
      <span class="session-text">
        Sesi√≥n iniciada como <strong id="user-email"></strong>
      </span>
    </div>

    <button id="btn-logout" type="button" class="btn-logout">Cerrar sesi√≥n</button>
  </header>
  <hr/>
  <div class="app-grid">
    <!-- Columna izquierda: formulario de NUEVA ausencia -->
    <section id="form-section">
      <h2>Registrar nueva ausencia</h2>
<ul>
        <li>üìÖ <strong>Una fecha</strong> ‚Üí crea una ausencia individual.</li>
        <li>üóìÔ∏è <strong>Con "Fecha hasta"</strong> ‚Üí se genera una ausencia por cada d√≠a en el rango indicado.</li>
      </ul>
      <form id="absence-form">
        <label>
          Docente
          <select id="teacher-select" required>
            <option value="">Selecciona‚Ä¶</option>
          </select>
        </label>

        <label>
          Fecha desde
          <input type="date" id="date-from" required />
        </label>

        <label>
          Fecha hasta (opcional)
          <input type="date" id="date-to" />
        </label>

        <label>
          Hora inicial (tramo)
          <input type="number" id="start-slot" min="1" max="14" value="1" required />
        </label>

        <label>
          Hora final (tramo)
          <input type="number" id="end-slot" min="1" max="14" value="14" required />
        </label>

        <label>
          Motivo (opcional)
          <textarea id="reason" rows="2"></textarea>
        </label>

<button type="submit" class="btn-save">Guardar ausencia</button>
        <div id="absence-message" class="message hidden"></div>
      </form>
    </section>

    <!-- Columna derecha: selector de fecha + lista de ausencias -->
    <section id="list-section">
      <h2>Ausencias del d√≠a</h2>
      <label>
        Fecha
        <input type="date" id="list-date" />
      </label>
<button type="button" id="btn-refresh-list" class="btn-refresh">Actualizar</button>

      <div id="list-container" style="margin-top: 0.75rem;"></div>
    </section>
  </div>
  <hr/>
    <section id="substitutions-section">
    <h2>üîÅ Gesti√≥n de sustituciones</h2>
      <p>
  En caso de sustituci√≥n, es necesario que las ausencias enviadas desde el formulario del centro se registren correctamente y que aparezca el nombre correcto en el panel general. Si el docente sustituto es asimismo sustituido, deber√° indicarse el cambio siempre con respecto al <strong>docente titular</strong>.
</p><p>Puede revertir la sustituci√≥n con el bot√≥n ‚ÄúQuitar sustituto‚Äù.</p>

    <div class="substitutions-layout">
      <!-- Bloque izquierda: sustituciones activas -->
      <div class="substitutions-block">
        <h3>Sustituciones activas</h3>
        <p class="absence-meta">Si el correo del formulario es distinto al del titular, se considera que hay una sustituci√≥n activa.</p>
        <table class="substitutions-table">
          <thead>
            <tr>
              <th>Titular</th>
              <th>Nombre en panel</th>
              <th>Email formulario</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="substitutions-body">
            <!-- Aqu√≠ se inyectar√°n las filas por JS -->
          </tbody>
        </table>
        <p id="substitutions-empty" class="absence-meta" style="margin-top:0.4rem; display:none;">
          No hay sustituciones activas.
        </p>
      </div>

      <!-- Bloque derecha: a√±adir sustituto -->
      <div class="substitutions-block">
        <h3>A√±adir / cambiar sustituto</h3>
        <form id="substitution-form">
          <label>
            Profesor titular
            <select id="substitution-teacher-select" required>
              <option value="">Selecciona titular‚Ä¶</option>
            </select>
          </label>

          <label>
            Nombre que se mostrar√° en el panel (Apellidos, Nombre)
            <input type="text" id="substitution-display-name" required />
          </label>

          <label>
            Email del sustituto
            <input type="email" id="substitution-email-form" required value="@iespoligonosur.org"/>
          </label>

          <button type="submit" class="btn-save">Guardar sustituci√≥n</button>
        </form>
      </div>
    </div>
  </section>

</section>

  <!-- Supabase JS desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
   <script src="script.js"></script>
    
</body>
</html>

