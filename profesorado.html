<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Gestión de ausencias - IES Polígono Sur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png" />
  <link rel="shortcut icon" href="img/favicon.ico" />
  <meta name="msapplication-TileColor" content="#2b5797" />
  <meta name="msapplication-TileImage" content="img/android-chrome-192x192.png" />
  <meta name="theme-color" content="#ffffff" />
</head>

<body>
  <div id="app">
    <h1>Gestión de ausencias del profesorado</h1>

    <section id="login-section" v-if="!isLoggedIn">
      <h2>Acceso</h2>
      <form @submit.prevent="handleLogin">
        <label>
          Correo
          <input type="email" v-model="loginForm.email" required />
        </label>
        <label>
          Contraseña
          <input type="password" v-model="loginForm.password" required />
        </label>
        <button type="submit">Entrar</button>
        <div v-if="loginMessage" class="message" :class="loginMessageType">{{ loginMessage }}</div>
      </form>
    </section>

    <section id="app-section" v-else>
      <header class="app-header">
        <div class="header-left">
          <span class="session-text">
            Sesión iniciada como <strong>{{ userEmail }}</strong>
          </span>
        </div>
        <button id="btn-logout" type="button" class="btn-logout" @click="handleLogout">Cerrar sesión</button>
      </header>

      <nav class="top-nav">
        <a class="nav-link" href="index.html">Ausencias</a>
        <a class="nav-link" href="panel.html">Panel</a>
        <a class="nav-link" href="justificaciones.html">Justificantes</a>
        <a class="nav-link active" href="profesorado.html">Profesorado</a>
        <a class="nav-link" href="gestion_profesorado.html">Gestión del profesorado</a>
        <a class="nav-link" href="permisos.html">Permisos</a>
        <a class="nav-link" href="control-presencia.html">Control de presencia</a>
        <a class="nav-link" href="ayuda.html">Ayuda</a>
      </nav>

      <section id="teachers-section">
        <div class="teacher-schedule-header">
          <div>
            <h2>Profesorado</h2>
            <p class="absence-meta">
              Consulta el horario semanal completo del docente, incluyendo horas marcadas como “no visibles”.
            </p>
          </div>
          <div class="teacher-schedule-controls">
            <label>
              Profesor/a
              <select v-model="teacherScheduleTeacher">
                <option value="">Selecciona…</option>
                <option v-for="teacher in teachers" :key="`schedule-${teacher.name}`" :value="teacher.name">
                  {{ teacher.name }}
                </option>
              </select>
            </label>
            <button type="button" class="btn-refresh" @click="loadTeacherSchedule"
              :disabled="!teacherScheduleTeacher || loadingTeacherSchedule">
              Actualizar
            </button>
          </div>
        </div>

        <div class="teacher-schedule-content">
          <p v-if="!teacherScheduleTeacher" class="absence-meta">Selecciona un docente para cargar su horario.</p>
          <p v-else-if="loadingTeacherSchedule" class="absence-meta">Cargando horario…</p>
          <p v-else-if="teacherScheduleMessage" class="absence-meta">{{ teacherScheduleMessage }}</p>
          <div v-else class="teacher-schedule-grid">
            <table class="schedule-table">
              <thead>
                <tr>
                  <th>Franja</th>
                  <th v-for="day in teacherScheduleDays" :key="`day-${day.value}`">{{ day.label }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="row in teacherScheduleGrid" :key="`slot-${row.slotValue}`">
                  <th>{{ row.slotLabel }}</th>
                  <td v-for="(cell, index) in row.days" :key="`cell-${row.slotValue}-${index}`">
                    <div v-if="cell.length" class="schedule-cell">
                      <article v-for="(classInfo, idx) in cell" :key="`class-${row.slotValue}-${index}-${idx}`"
                        class="schedule-class" :class="{ 'schedule-class--hidden': !classInfo.visible }"
                        @click="startClassInlineEdit(classInfo)">
                        <template v-if="!classInfo.editing">
                          <p class="schedule-class-main">{{ classInfo.subject }}</p>
                          <p v-if="classInfo.group" class="schedule-class-meta">{{ classInfo.group }}</p>
                          <p v-if="classInfo.classroom" class="schedule-class-meta">Aula: {{ classInfo.classroom }}</p>
                          <span v-if="!classInfo.visible" class="schedule-badge">No visible</span>
                        </template>
                        <div v-else class="schedule-class-edit">
                          <p class="schedule-edit-help">Edita cada clase del tramo por separado.</p>
                          <div v-for="(entry, editIndex) in classInfo.editEntries"
                            :key="`edit-${classInfo.slotValue}-${classInfo.weekdayValue}-${entry.id || editIndex}`"
                            class="schedule-edit-entry" @click.stop>
                            <div class="schedule-edit-grid">
                              <label class="schedule-edit-label">
                                Materia
                                <input type="text" v-model="entry.subject" />
                              </label>
                              <label class="schedule-edit-label">
                                Grupo
                                <input type="text" v-model="entry.group" />
                              </label>
                              <label class="schedule-edit-label">
                                Aula
                                <input type="text" v-model="entry.classroom" />
                              </label>
                              <label class="schedule-edit-toggle">
                                <input type="checkbox" v-model="entry.visible" />
                                Mostrar en panel
                              </label>
                            </div>
                            <p v-if="!entry.id" class="schedule-edit-warning">
                              No se puede guardar este bloque porque no tiene identificador.
                            </p>
                          </div>
                          <div class="schedule-edit-actions" @click.stop>
                            <button type="button" class="btn-save" @click="saveClassInlineEdit(classInfo)"
                              :disabled="classInfo.saving">
                              Guardar
                            </button>
                            <button type="button" class="btn-secondary" @click="cancelClassInlineEdit(classInfo)"
                              :disabled="classInfo.saving">
                              Cancelar
                            </button>
                            <span v-if="classInfo.editMessage" class="schedule-edit-message"
                              :class="classInfo.editMessageType">
                              {{ classInfo.editMessage }}
                            </span>
                          </div>
                        </div>
                      </article>
                    </div>
                    <div v-else class="schedule-cell schedule-cell--empty">-</div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </section>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
</body>

</html>




